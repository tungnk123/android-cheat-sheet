- open weather api key: 3.0 one call vs 2.5
- 
---
1. **Orientation & Layout**
	- An Activity forced to **landscape** (`screenOrientation="landscape"`) does **not** need a portrait layout.
	- **Fragments and CustomViews always need a valid layout** (at least one). Missing layouts will **crash**.
	- `Resources$NotFoundException` / `InflateException` are **layout issues**, not orientation issues.
	- Do **not** use `<merge>` as an Activity root.
	- Any layout inflated by a Fragment or CustomView must exist (`layout/` or `layout-land/`).
2. **Weather Logic**
	- Call the API **once** → store **current + 24h hourly list**.
	- Each hour, read from DB to get **current hour weather**; **do not re-call API**.
	- Refresh API only when:
		- User moves beyond a distance threshold, **or**
		- Hourly data expires (dt < now).
		- Use an **hourly ticker** (emit once per hour) to trigger DB reads.
3. **Flow & State**
	- `StateFlow(initialValue = null)` will emit `null` initially (expected).
	- `flatMapLatest { dao.observe(now) }` returns `null` if DB has no matching record.
	- Avoid minute/second tickers when logic is hourly.
4. **Location → Weather**
	- Use `distinctUntilChanged` with **distance-based comparison** to avoid frequent refreshes.
	- Fused Location updates frequently → debounce by distance.
5. **Music / Foreground Service**
	- Start with `startForegroundService()` → **call** `**startForeground()**` **immediately** in the service.
	- Stop by sending **ACTION_STOP** via `startService()` → `stopForeground()` + `stopSelf()`.
	- If there is no Stop button, stop when **queue ends**, **notification is dismissed**, or **app decides to release**.
	- Declare `foregroundServiceType="mediaPlayback"` (Android 12+).
6. **Crash Patterns**
	- Landscape-only Activity + missing Fragment/CustomView layout → crash.
	- Billing `PendingIntent` null → purchase flow issue (not orientation-related).
	- `ForegroundServiceStartNotAllowedException` → incorrect timing/usage of `startForeground()`.
7. **Rule of Thumb**
	- **Landscape-only Activity is fine**.
	- **Fragments/CustomViews must always have layouts**.
	- **Minimize API calls; rely on DB reads**.
	- **Manage service lifecycle explicitly (start/stop)**.